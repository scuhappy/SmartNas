<!DOCTYPE html>
<html>
<head>
    <title>Ollama 通信测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow">
        <h1 class="text-2xl font-bold mb-4">Ollama 通信测试</h1>
        <button id="test-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mb-4">
            测试与Qwen2通信
        </button>
        <div id="status" class="mb-4 p-3 rounded border"></div>
        <div id="response" class="p-3 rounded border bg-gray-50 whitespace-pre-wrap"></div>
    </div>

    <script>
        document.getElementById('test-btn').addEventListener('click', async () => {
            const statusDiv = document.getElementById('status');
            const responseDiv = document.getElementById('response');
            
            statusDiv.textContent = '正在发送请求...';
            statusDiv.className = 'mb-4 p-3 rounded border border-yellow-300 bg-yellow-50';
            responseDiv.textContent = '';
            
            try {
                // 直接使用与curl相同的请求参数
                const response = await fetch('http://localhost:11434/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        "model": "qwen2:0.5b-instruct",
                        "messages": [{"role": "user", "content": "hello"}]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP错误: ${response.status}`);
                }
                
                const data = await response.json();
                statusDiv.textContent = '请求成功!';
                statusDiv.className = 'mb-4 p-3 rounded border border-green-300 bg-green-50';
                responseDiv.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                statusDiv.textContent = `请求失败: ${error.message}`;
                statusDiv.className = 'mb-4 p-3 rounded border border-red-300 bg-red-50';
                responseDiv.textContent = '错误详情:\n' + error.stack;
            }
        });
    </script>
</body>
</html>
    